## db文件说明
此文档对应的文件是 `system/db.php`，这里主要记录思考的过程，文档里会选择性的展示部分代码实现，因为是 `demo` 的关系，并没有考虑的那么全面，以跑通流程为主。

特别声明，此系列文档和实际的 `demo` 文件关系非常精密，最佳的操作方式是配置好本地环境，在 IDE 中边读边运行，这样才能很好的理解。所以，文档里的描述默认在使用 IDE 的情况下进行描述。

手写的 `db.php` 文件非常的简略，并没有考虑很复杂的情况，提供的功能也很简单，仅满足基本的 `CURD` 需求，总共大概 200 行左右，文件过大，采取前面的一行行对应解释便不再合适。下面会先按照骨架搭建大致说明，并配以思考过程。

### 数据库操作怎么写？
配合官方文档手册，可以知道，官方提供了各种不同数据库的扩展，以本 `demo` 使用的 `mysql` 为例，在高版本的 `php` 中是默认安装的，如果没有安装，可能需要自己安装扩展之后才能使用。

由此又可以引申出下面几个问题：
- 如何查看扩展？
- 如何安装扩展？

#### 如何查看扩展
`php`提供了一个系统函数，用来输出相关信息，`phpinfo()` 可以拿到所有相关的信息。

#### 如何安装扩展
官方文档中有详细的说明，不同的操作系统有不同的方式，`linux` 和 `windows` 各有各的要求。
 ---

 确认了环境中已经安装好了 `mysql` 扩展，那么如何和数据库建立连接？如何操作数据库？

 `PHP` 提供了一个叫 `PDO` 的功能类，其具体作用就是对各种数据库操作接口进行抽象处理，达到的效果是使用同样的 `SQL` 语句，既能操作 `MYSQL`，也能操作 `Oracle`,`PostgreSQL`,`DB2` 等等。所以叫 PHP数据库抽象层，类似于操作系统，封装了硬件的操作细节，对外提供统一的接口，`PDO` 就提供了这样的功能。

 很显然，`db.php` 中需要使用 `PDO` 来进行进一步的封装，构建我们自己的功能函数，基本上各个框架的特点就在此处体现，下面是设计时的思路

- 数据库类
  - 连接数据库
  - 操作数据
    - 新增
    - 删除
    - 更新
    - 查询
      - 查询单条
      - 查询多条

顺着这个框架，一步一步去完善，最终就得到了 `db.php`。

**连接数据库**
`PDO` 提供了各种功能，依然需要参考官方手册，创建一个新的连接需要 `new  PDO ( $dsn ,  $user ,  $password );`，其中 `$dsn` 给了这样的一个示例 `mysql:dbname=testdb;host=127.0.0.1` ,意味着如果要连接到指定的数据库，需要弄清楚这几个参数值 `dbname`,`host`,`user`,`password`。`db.php` 在构造函数中创建数据库连接。

这样就创建了一个 `PDO` 对象，接下来要做的事情就是操作数据。

**操作数据**
操作数据，简单的讲就是四个基本操作，增删改查（`CURD`），需要创建对应的方法，所有有了 `db.php` 中的五个最主要的方法 `find()`,`select()`,`insert()`,`update()`,`delete()`。其他的所有方法都是辅助这5个主要方法的，可看可不看，什么都要抓，很容易陷入到细节的陷阱中出不来。

**辅助方法**
前面提及了 `db.php` 文件最主要的就是析构函数中的数据库连接以及余下的5个主要方法。其他的方法统归到辅助方法中，先说辅助方法的存在意义和目的，暂时不说具体实现细节。辅助方法的目的在我看来就是为了让主要方法的逻辑清晰，调用方便。这是终极目的，终极目的确定了，实现方式并无定式，比如，这里的数据库类可以自己手撸，也可以引入第三方库，如何引入和 1.1 版本中的模板引擎一样。

市面上的框架基本都支持配置，这里提一个问题，如果我们也要实现配置效果，怎么做呢？

很简单，只需要在建立数据库连接前先看看是否有相关配置即可，这里又可以添加一个辅助方法来完成这部分的任务，然后加到构造函数 `new PDO` 之前就可以了。不仅仅是数据库相关配置，其他所有的配置生效的原理都一样，在调用相关的方法之前先检查配置即可，关键点在于检查的位置，在学习其他框架的过程中，这些辅助方法完全可以删除，先理解了主干，再深入细节，学习过程会简单的多。这样做的好处在于层次结构会非常的清晰，先看清楚骨头，然后再往上加毛细血管，而不是粗的细的一起呈现。
